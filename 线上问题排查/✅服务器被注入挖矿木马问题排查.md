# ✅服务器被注入挖矿木马问题排查

我有一台云服务器，用于部署一个我的个人博客的。最近收到告警，说挂了挖矿程序



![1733643005567-99520252-1a63-4e21-bc8f-68c385e1f456.jpeg](./img/p4MdDCbfUQ7QSeVz/1733643005567-99520252-1a63-4e21-bc8f-68c385e1f456-765572.jpeg)



首先看下这个程序是不是已经在跑了，top看下运行的进程，发现有一个kswapd0进行耗CPU比较高，这个进程本身是个linux的后台进程，负责内存交换的，但是熟悉的都知道，他其实是个老演员了。

![1733643021771-2081d415-fb9b-4516-bc80-d3ca04585647.jpeg](./img/p4MdDCbfUQ7QSeVz/1733643021771-2081d415-fb9b-4516-bc80-d3ca04585647-451102.jpeg)



正常的kswapd0不会一直在，也不会占CPU这么高，所以怀疑接下来用 netstat -antlp 看看网络连接情况，挖矿不可能没有远程传输吧。



![1733643033099-cfca190f-fe81-422c-a045-45c223dff2f6.jpeg](./img/p4MdDCbfUQ7QSeVz/1733643033099-cfca190f-fe81-422c-a045-45c223dff2f6-334989.jpeg)



不查不知道，一查就发现了老朋友。通过netstat发现一个瑞士的IP在和kswapd0通信，同时有两个一个罗马尼亚的ip在和rsync这个数据传输进程在不断通信。

![1733643065435-6c25c878-7edf-4a1b-b5e5-988d144595f5.jpeg](./img/p4MdDCbfUQ7QSeVz/1733643065435-6c25c878-7edf-4a1b-b5e5-988d144595f5-850263.jpeg)



接下来就要深挖了，找到这个kswapd0占用的文件路径到底在哪，进入/proc/<pid>这个目录，我这里的<pid>是67498：



![1733643072322-abb85034-d216-4723-9ce7-db871d14b125.jpeg](./img/p4MdDCbfUQ7QSeVz/1733643072322-abb85034-d216-4723-9ce7-db871d14b125-360887.jpeg)



最终发现是在git用户在有个文件夹，那这个文件夹就可以直接干掉了。



接下来就是删除文件夹、kill掉进程



检查并清除定时任务，删除被黑的账号，

![17301161156604.jpg](./img/p4MdDCbfUQ7QSeVz/1744702533000-879aa475-fa13-450e-8fbb-04f26ea42160-858566.jpeg)



![17301161364605.jpg](./img/p4MdDCbfUQ7QSeVz/1744702533090-69a87f3c-0e4e-4073-ac6f-5ebe9ed52527-791032.jpeg)



清楚这个用户的密钥：

![17301161864500.jpg](./img/p4MdDCbfUQ7QSeVz/1744702533243-74d37c84-cd77-4f06-93fb-1617b1f599eb-622780.jpeg)



![17301161969683-scaled.jpg](./img/p4MdDCbfUQ7QSeVz/1744702533036-acc9f181-215b-4605-928a-f3b0d9896250-507229.jpeg)



然后机器就恢复正常了。

![17301175667214.jpg](./img/p4MdDCbfUQ7QSeVz/1744702533026-4761d6c9-6a44-49fc-b91e-82357e1e3a01-063031.jpeg)



> 更新: 2024-12-08 15:33:50  
> 原文: <https://www.yuque.com/hollis666/vhr2ge/qyptd5ubbyvgvq0e>